[2025-10-14 09:08:42.511 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 09:08:42.576 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 64.7784ms
[2025-10-14 09:08:42.703 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 09:08:43.115 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 411.4605ms
[2025-10-14 10:11:52.735 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 10:11:53.333 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 10:11:53.334 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 10:11:53.504 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 10:11:53.505 +03:00  INF]  Hosting environment: Development
[2025-10-14 10:11:53.505 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 10:11:54.759 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 10:11:55.639 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 893.0289ms
[2025-10-14 10:11:55.660 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 10:11:55.661 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 10:11:55.850 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 189.9157ms
[2025-10-14 10:11:56.070 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 409.691ms
[2025-10-14 10:11:56.252 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 10:11:56.502 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 250.9387ms
[2025-10-14 10:14:41.368 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 744
[2025-10-14 10:14:41.381 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:14:42.905 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:14:42.928 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:14:48.203 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:14:48.233 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 5300.8472ms
[2025-10-14 10:14:48.233 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:14:48.236 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 85 application/json; charset=utf-8 6868.0806ms
[2025-10-14 10:14:58.693 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 744
[2025-10-14 10:14:58.694 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:14:58.742 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:14:58.743 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:15:16.238 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:15:16.239 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 17495.9085ms
[2025-10-14 10:15:16.239 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:15:16.239 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 85 application/json; charset=utf-8 17546.445ms
[2025-10-14 10:15:32.947 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 741
[2025-10-14 10:15:32.947 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:15:32.951 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:15:32.951 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:16:02.079 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:16:02.084 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 29133.1724ms
[2025-10-14 10:16:02.084 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:16:02.088 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 85 application/json; charset=utf-8 29139.9133ms
[2025-10-14 10:20:54.105 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 10:20:54.784 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 10:20:54.785 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 10:20:55.143 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 10:20:55.144 +03:00  INF]  Hosting environment: Development
[2025-10-14 10:20:55.144 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 10:20:55.664 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 10:20:56.006 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 10:20:56.006 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 10:20:56.010 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 360.6648ms
[2025-10-14 10:20:56.023 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 16.8664ms
[2025-10-14 10:20:56.102 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 95.6411ms
[2025-10-14 10:20:56.172 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 10:20:56.321 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 149.3536ms
[2025-10-14 10:21:43.948 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 744
[2025-10-14 10:21:43.960 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:21:44.138 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:21:44.162 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:21:56.692 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:21:56.740 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 12573.8861ms
[2025-10-14 10:21:56.740 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:21:56.742 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 85 application/json; charset=utf-8 12794.3973ms
[2025-10-14 10:22:03.000 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 741
[2025-10-14 10:22:03.001 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:22:03.011 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:22:03.011 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:22:05.517 +03:00  INF]  Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM trips_booking AS t
[2025-10-14 10:22:05.606 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(t.id)
FROM trips_booking AS t
[2025-10-14 10:22:05.842 +03:00  INF]  Executed DbCommand (25ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?', @p2='?', @p3='?' (DbType = DateTime2), @p4='?', @p5='?' (DbType = Int32), @p6='?', @p7='?' (DbType = Int32), @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?', @p15='?' (DbType = Int32), @p16='?' (DbType = Boolean), @p17='?', @p18='?', @p19='?' (DbType = Int16), @p20='?' (DbType = Int32), @p21='?' (DbType = Decimal), @p22='?', @p23='?' (DbType = DateTime2), @p24='?' (DbType = Int64), @p25='?' (DbType = DateTime2), @p26='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO trips_booking (id, booking_code, booking_code_auto, booking_date, booking_notes, booking_status, child_ages, child_num, client_email, client_id, client_name, client_nationality, client_phone, currency_code, gift_code, infant_num, is_two_way, pickup_address, pickup_time, pricing_type, total_pax, total_price, trip_code, trip_date, trip_id, trip_return_date, trip_type)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
[2025-10-14 10:22:10.405 +03:00  INF]  Executed DbCommand (5ms) [Parameters=[@__ToLower_1='?', @__isExtra_2='?' (DbType = Boolean), @__is_obligatory_3='?' (DbType = Boolean), @__trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT f0.facility_desc, f0.facility_name, f2.extra_price, f2.currency_code, f2.is_extra, t.facility_id, f2.pricing_type, f2.is_obligatory
FROM trip_facility AS t
INNER JOIN (
    SELECT f.facility_desc, f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON t.facility_id = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.currency_code, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.active AND f1.is_extra = @__isExtra_2 AND f1.is_obligatory = @__is_obligatory_3
) AS f2 ON t.facility_id = f2.id
WHERE t.trip_id = @__trip_id_0
[2025-10-14 10:22:18.112 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__row_extra_id_0='?' (DbType = Int32), @__row_booking_id_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.id, b.booking_id, b.created_at, b.created_by, b.extra_count, b.extra_id, b.updated_at
FROM booking_extra AS b
WHERE b.extra_id = @__row_extra_id_0 AND b.booking_id = @__row_booking_id_1
LIMIT 2
[2025-10-14 10:22:18.117 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM booking_extra AS b
[2025-10-14 10:22:18.124 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(b.id)
FROM booking_extra AS b
[2025-10-14 10:22:18.170 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO booking_extra (id, booking_id, created_at, created_by, extra_count, extra_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING updated_at;
[2025-10-14 10:22:18.191 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[@__row_extra_id_0='?' (DbType = Int32), @__row_booking_id_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.id, b.booking_id, b.created_at, b.created_by, b.extra_count, b.extra_id, b.updated_at
FROM booking_extra AS b
WHERE b.extra_id = @__row_extra_id_0 AND b.booking_id = @__row_booking_id_1
LIMIT 2
[2025-10-14 10:22:18.191 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM booking_extra AS b
[2025-10-14 10:22:18.192 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(b.id)
FROM booking_extra AS b
[2025-10-14 10:22:18.194 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO booking_extra (id, booking_id, created_at, created_by, extra_count, extra_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING updated_at;
[2025-10-14 10:22:19.256 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__8__locals1_req_trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.active, t.created_at, t.created_by, t.destination_id, t.is_comm_soon, t.pickup, t.release_days, t.route, t.show_in_slider, t.show_in_top, t.transfer_category_id, t.trip_code, t.trip_code_auto, t.trip_default_name, t.trip_duration, t.trip_order, t.trip_type, t.updated_at
FROM trip_main AS t
WHERE t.id = @__8__locals1_req_trip_id_0
LIMIT 2
[2025-10-14 10:22:19.328 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__8__locals2_trip_id_0='?' (DbType = Int64), @__ToLower_1='?', @__capacity_2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.child_price, t.created_at, t.created_by, t.currency_code, t.notes, t.pax_from, t.pax_to, t.pricing_type, t.trip_id, t.trip_origin_price, t.trip_sale_price, t.updated_at
FROM trip_prices AS t
WHERE t.trip_id = @__8__locals2_trip_id_0 AND lower(t.currency_code) = @__ToLower_1 AND t.pax_from <= @__capacity_2 AND (t.pax_to >= @__capacity_2 OR t.pax_to = 0)
LIMIT 2
[2025-10-14 10:22:19.383 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__age_0='?' (DbType = Int32), @__8__locals1_req_trip_id_1='?' (DbType = Int64), @__ToLower_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT c.policy_id, c.age_from, c.age_to, c.child_price, c.code_auto, c.created_at, c.created_by, c.currency_code, c.notes, c.pricing_type, c.trip_id, c.updated_at
FROM child_policy_setting AS c
WHERE @__age_0 >= c.age_from AND @__age_0 <= c.age_to AND c.trip_id = @__8__locals1_req_trip_id_1 AND lower(c.currency_code) = @__ToLower_2
LIMIT 1
[2025-10-14 10:22:19.384 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[@__age_0='?' (DbType = Int32), @__8__locals1_req_trip_id_1='?' (DbType = Int64), @__ToLower_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT c.policy_id, c.age_from, c.age_to, c.child_price, c.code_auto, c.created_at, c.created_by, c.currency_code, c.notes, c.pricing_type, c.trip_id, c.updated_at
FROM child_policy_setting AS c
WHERE @__age_0 >= c.age_from AND @__age_0 <= c.age_to AND c.trip_id = @__8__locals1_req_trip_id_1 AND lower(c.currency_code) = @__ToLower_2
LIMIT 1
[2025-10-14 10:22:19.429 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__8__locals1_req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__8__locals1_req_booking_id_0
LIMIT 2
[2025-10-14 10:22:19.481 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 10:22:19.484 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:22:19.485 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 16473.8993ms
[2025-10-14 10:22:19.485 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:22:19.496 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 123 application/json; charset=utf-8 16495.8027ms
[2025-10-14 10:23:50.799 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - application/json-patch+json 741
[2025-10-14 10:23:50.833 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:23:50.839 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:23:50.840 +03:00  INF]  Route matched with {action = "SaveClientBooking", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult SaveClientBooking(ITravelApp.Data.Models.Bookings.BookingCls) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:23:52.500 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM trips_booking AS t
[2025-10-14 10:23:52.501 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(t.id)
FROM trips_booking AS t
[2025-10-14 10:23:52.506 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?', @p2='?', @p3='?' (DbType = DateTime2), @p4='?', @p5='?' (DbType = Int32), @p6='?', @p7='?' (DbType = Int32), @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?', @p15='?' (DbType = Int32), @p16='?' (DbType = Boolean), @p17='?', @p18='?', @p19='?' (DbType = Int16), @p20='?' (DbType = Int32), @p21='?' (DbType = Decimal), @p22='?', @p23='?' (DbType = DateTime2), @p24='?' (DbType = Int64), @p25='?' (DbType = DateTime2), @p26='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO trips_booking (id, booking_code, booking_code_auto, booking_date, booking_notes, booking_status, child_ages, child_num, client_email, client_id, client_name, client_nationality, client_phone, currency_code, gift_code, infant_num, is_two_way, pickup_address, pickup_time, pricing_type, total_pax, total_price, trip_code, trip_date, trip_id, trip_return_date, trip_type)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
[2025-10-14 10:23:53.198 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__isExtra_2='?' (DbType = Boolean), @__is_obligatory_3='?' (DbType = Boolean), @__trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT f0.facility_desc, f0.facility_name, f2.extra_price, f2.currency_code, f2.is_extra, t.facility_id, f2.pricing_type, f2.is_obligatory
FROM trip_facility AS t
INNER JOIN (
    SELECT f.facility_desc, f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON t.facility_id = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.currency_code, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.active AND f1.is_extra = @__isExtra_2 AND f1.is_obligatory = @__is_obligatory_3
) AS f2 ON t.facility_id = f2.id
WHERE t.trip_id = @__trip_id_0
[2025-10-14 10:23:53.199 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__row_extra_id_0='?' (DbType = Int32), @__row_booking_id_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.id, b.booking_id, b.created_at, b.created_by, b.extra_count, b.extra_id, b.updated_at
FROM booking_extra AS b
WHERE b.extra_id = @__row_extra_id_0 AND b.booking_id = @__row_booking_id_1
LIMIT 2
[2025-10-14 10:23:53.200 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM booking_extra AS b
[2025-10-14 10:23:53.201 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(b.id)
FROM booking_extra AS b
[2025-10-14 10:23:53.204 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO booking_extra (id, booking_id, created_at, created_by, extra_count, extra_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING updated_at;
[2025-10-14 10:23:53.206 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[@__row_extra_id_0='?' (DbType = Int32), @__row_booking_id_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.id, b.booking_id, b.created_at, b.created_by, b.extra_count, b.extra_id, b.updated_at
FROM booking_extra AS b
WHERE b.extra_id = @__row_extra_id_0 AND b.booking_id = @__row_booking_id_1
LIMIT 2
[2025-10-14 10:23:53.206 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM booking_extra AS b
[2025-10-14 10:23:53.207 +03:00  INF]  Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT max(b.id)
FROM booking_extra AS b
[2025-10-14 10:23:53.209 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO booking_extra (id, booking_id, created_at, created_by, extra_count, extra_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING updated_at;
[2025-10-14 10:23:53.881 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__8__locals1_req_trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.active, t.created_at, t.created_by, t.destination_id, t.is_comm_soon, t.pickup, t.release_days, t.route, t.show_in_slider, t.show_in_top, t.transfer_category_id, t.trip_code, t.trip_code_auto, t.trip_default_name, t.trip_duration, t.trip_order, t.trip_type, t.updated_at
FROM trip_main AS t
WHERE t.id = @__8__locals1_req_trip_id_0
LIMIT 2
[2025-10-14 10:23:53.884 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__8__locals2_trip_id_0='?' (DbType = Int64), @__ToLower_1='?', @__capacity_2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.child_price, t.created_at, t.created_by, t.currency_code, t.notes, t.pax_from, t.pax_to, t.pricing_type, t.trip_id, t.trip_origin_price, t.trip_sale_price, t.updated_at
FROM trip_prices AS t
WHERE t.trip_id = @__8__locals2_trip_id_0 AND lower(t.currency_code) = @__ToLower_1 AND t.pax_from <= @__capacity_2 AND (t.pax_to >= @__capacity_2 OR t.pax_to = 0)
LIMIT 2
[2025-10-14 10:23:53.886 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__age_0='?' (DbType = Int32), @__8__locals1_req_trip_id_1='?' (DbType = Int64), @__ToLower_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT c.policy_id, c.age_from, c.age_to, c.child_price, c.code_auto, c.created_at, c.created_by, c.currency_code, c.notes, c.pricing_type, c.trip_id, c.updated_at
FROM child_policy_setting AS c
WHERE @__age_0 >= c.age_from AND @__age_0 <= c.age_to AND c.trip_id = @__8__locals1_req_trip_id_1 AND lower(c.currency_code) = @__ToLower_2
LIMIT 1
[2025-10-14 10:23:53.888 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__age_0='?' (DbType = Int32), @__8__locals1_req_trip_id_1='?' (DbType = Int64), @__ToLower_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT c.policy_id, c.age_from, c.age_to, c.child_price, c.code_auto, c.created_at, c.created_by, c.currency_code, c.notes, c.pricing_type, c.trip_id, c.updated_at
FROM child_policy_setting AS c
WHERE @__age_0 >= c.age_from AND @__age_0 <= c.age_to AND c.trip_id = @__8__locals1_req_trip_id_1 AND lower(c.currency_code) = @__ToLower_2
LIMIT 1
[2025-10-14 10:23:53.893 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__8__locals1_req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__8__locals1_req_booking_id_0
LIMIT 2
[2025-10-14 10:23:53.896 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 10:23:53.897 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 10:23:53.897 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App) in 3057.4625ms
[2025-10-14 10:23:53.897 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.SaveClientBooking (ITravel_App)'
[2025-10-14 10:23:53.898 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/SaveClientBooking - 200 123 application/json; charset=utf-8 3099.6153ms
[2025-10-14 10:24:43.205 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 10:24:43.208 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:24:43.209 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 10:24:43.222 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:24:43.358 +03:00  INF]  Executed DbCommand (19ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 10:24:43.395 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 10:24:43.397 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 10:24:43.401 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 10:24:43.417 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 194.5834ms
[2025-10-14 10:24:43.417 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 10:24:43.419 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 213.8502ms
[2025-10-14 10:26:03.897 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 10:26:03.900 +03:00  INF]  CORS policy execution successful.
[2025-10-14 10:26:03.901 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 10:26:03.901 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 10:26:03.925 +03:00  INF]  Executed DbCommand (22ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 10:26:03.927 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 10:26:03.928 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 10:26:03.929 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 10:26:03.929 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 27.8789ms
[2025-10-14 10:26:03.929 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 10:26:03.929 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 32.7231ms
[2025-10-14 12:20:10.121 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 12:20:11.030 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 12:20:11.031 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 12:20:11.896 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 12:20:11.897 +03:00  INF]  Hosting environment: Development
[2025-10-14 12:20:11.897 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 12:20:12.965 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 12:20:13.797 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 846.7043ms
[2025-10-14 12:20:14.792 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 12:20:14.801 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 8.5644ms
[2025-10-14 12:20:14.911 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 12:20:14.998 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 87.0157ms
[2025-10-14 12:20:16.955 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 12:20:17.056 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 101.1481ms
[2025-10-14 12:20:55.784 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 12:20:55.800 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:20:58.808 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:20:58.863 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:21:03.823 +03:00  INF]  Executed DbCommand (155ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:21:04.194 +03:00  INF]  Executed DbCommand (11ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:21:04.208 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:21:04.229 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 12:21:04.382 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 5510.2534ms
[2025-10-14 12:21:04.383 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:21:04.399 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 8615.6702ms
[2025-10-14 12:24:54.660 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 12:24:54.670 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:24:54.689 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:24:54.689 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:24:54.768 +03:00  INF]  Executed DbCommand (12ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:24:54.776 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:24:54.780 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:24:54.783 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 12:24:54.786 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 96.1393ms
[2025-10-14 12:24:54.786 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:24:54.787 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 127.734ms
[2025-10-14 12:26:21.181 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 12:26:21.222 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:26:21.232 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:26:21.232 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:26:21.482 +03:00  INF]  Executed DbCommand (13ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:26:21.491 +03:00  INF]  Executed DbCommand (7ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:26:21.493 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:26:21.494 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 12:26:21.495 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 262.0266ms
[2025-10-14 12:26:21.495 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:26:21.495 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 314.6844ms
[2025-10-14 12:26:59.801 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - application/json-patch+json 62
[2025-10-14 12:26:59.801 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:26:59.802 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:26:59.802 +03:00  INF]  Route matched with {action = "GetBookingWithDetails", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBookingWithDetails(ITravelApp.Data.Models.Bookings.BookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:26:59.809 +03:00  INF]  Executed DbCommand (4ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:26:59.813 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:26:59.815 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:26:59.816 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.Bookings.Client.BookingSummary'.
[2025-10-14 12:26:59.817 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App) in 14.3199ms
[2025-10-14 12:26:59.817 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetBookingWithDetails (ITravel_App)'
[2025-10-14 12:26:59.817 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetBookingSummary - 200 1970 application/json; charset=utf-8 16.5819ms
[2025-10-14 12:27:26.533 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:27:26.538 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:27:26.542 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:27:26.553 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:27:26.597 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:27:27.102 +03:00  INF]  Executed DbCommand (13ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:27:27.118 +03:00  INF]  Executed DbCommand (4ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:27:58.329 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 31776.478ms
[2025-10-14 12:27:58.330 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:27:58.333 +03:00  ERR]  An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at AspNetCoreGeneratedDocument.Views_Email_BookingClientEmail_en.<>c__DisplayClass9_0.<<ExecuteAsync>b__1>d.MoveNext() in D:\horizen\api\ITravel_App\ITravel_App\Views\Email\BookingClientEmail_en.cshtml:line 131
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperExecutionContext.SetOutputContentAsync()
   at AspNetCoreGeneratedDocument.Views_Email_BookingClientEmail_en.ExecuteAsync() in D:\horizen\api\ITravel_App\ITravel_App\Views\Email\BookingClientEmail_en.cshtml:line 26
   at Microsoft.AspNetCore.Mvc.Razor.RazorView.RenderPageCoreAsync(IRazorPage page, ViewContext context)
   at Microsoft.AspNetCore.Mvc.Razor.RazorView.RenderPageAsync(IRazorPage page, ViewContext context, Boolean invokeViewStarts)
   at Microsoft.AspNetCore.Mvc.Razor.RazorView.RenderAsync(ViewContext context)
   at ITravel_App.services.CustomViewRendererService.RenderViewToStringAsync(String viewPath, Object model, ControllerContext actionContext) in D:\horizen\api\ITravel_App\ITravel_App\Services\CustomViewRendererService.cs:line 39
   at ITravel_App.Controllers.BookingController.ConfirmBooking(ConfirmBookingReq req) in D:\horizen\api\ITravel_App\ITravel_App\Controllers\BookingController.cs:line 124
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
[2025-10-14 12:27:58.400 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 500 null text/plain; charset=utf-8 31866.925ms
[2025-10-14 12:31:29.237 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:31:29.237 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:31:29.241 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:31:29.241 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:31:29.283 +03:00  INF]  Executed DbCommand (35ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:31:29.306 +03:00  INF]  Executed DbCommand (6ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:31:29.313 +03:00  INF]  Executed DbCommand (5ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:31:29.325 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:31:29.328 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:31:29.415 +03:00  INF]  Executed DbCommand (24ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:31:33.369 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:31:33.370 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 4128.4992ms
[2025-10-14 12:31:33.370 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:31:33.372 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 5 application/json; charset=utf-8 4139.0726ms
[2025-10-14 12:31:37.710 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:31:37.710 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:31:37.711 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:31:37.711 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:31:37.816 +03:00  INF]  Executed DbCommand (4ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:31:37.821 +03:00  INF]  Executed DbCommand (4ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:31:37.840 +03:00  INF]  Executed DbCommand (18ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:31:37.850 +03:00  INF]  Executed DbCommand (8ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:31:37.852 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:31:37.859 +03:00  INF]  Executed DbCommand (5ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:31:45.191 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:31:45.191 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 7480.6091ms
[2025-10-14 12:31:45.191 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:31:45.192 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 5 application/json; charset=utf-8 7481.6409ms
[2025-10-14 12:36:04.323 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 12:36:04.967 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 12:36:04.969 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 12:36:06.122 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 12:36:06.123 +03:00  INF]  Hosting environment: Development
[2025-10-14 12:36:06.123 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 12:36:06.280 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 12:36:06.775 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 529.8319ms
[2025-10-14 12:36:06.827 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 12:36:06.935 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 12:36:06.942 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 83.4292ms
[2025-10-14 12:36:07.012 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 76.739ms
[2025-10-14 12:36:07.132 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 12:36:07.395 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 263.2592ms
[2025-10-14 12:37:27.227 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:37:27.241 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:37:27.737 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:37:27.801 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:37:31.342 +03:00  INF]  Executed DbCommand (136ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:37:31.988 +03:00  INF]  Executed DbCommand (23ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:37:32.127 +03:00  INF]  Executed DbCommand (21ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:37:32.364 +03:00  INF]  Executed DbCommand (6ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:37:32.375 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:37:32.430 +03:00  INF]  Executed DbCommand (14ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:37:53.640 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:37:53.697 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 25886.4518ms
[2025-10-14 12:37:53.698 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:37:53.725 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 4 application/json; charset=utf-8 26497.6807ms
[2025-10-14 12:44:56.575 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 12:44:58.015 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 12:44:58.016 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 12:44:58.253 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 12:44:58.254 +03:00  INF]  Hosting environment: Development
[2025-10-14 12:44:58.254 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 12:44:59.016 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 12:44:59.418 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 416.729ms
[2025-10-14 12:44:59.447 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 12:44:59.448 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 12:44:59.468 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 19.7955ms
[2025-10-14 12:44:59.545 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 97.8957ms
[2025-10-14 12:44:59.611 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 12:44:59.839 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 228.4919ms
[2025-10-14 12:45:43.359 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:45:43.381 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:45:43.788 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:45:43.861 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:45:47.565 +03:00  INF]  Executed DbCommand (150ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:45:48.096 +03:00  INF]  Executed DbCommand (17ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:45:48.179 +03:00  INF]  Executed DbCommand (18ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:45:48.460 +03:00  INF]  Executed DbCommand (6ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:45:48.471 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:45:48.535 +03:00  INF]  Executed DbCommand (21ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:46:10.392 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:46:10.483 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 26612.198ms
[2025-10-14 12:46:10.484 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:46:10.500 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 4 application/json; charset=utf-8 27140.4056ms
[2025-10-14 12:46:52.090 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:46:52.091 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:46:52.110 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:46:52.111 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:46:52.187 +03:00  INF]  Executed DbCommand (8ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:46:52.200 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:46:52.205 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:47:04.865 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 12753.5603ms
[2025-10-14 12:47:04.866 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:47:04.867 +03:00  ERR]  An unhandled exception has occurred while executing the request.
System.ArgumentNullException: Value cannot be null. (Parameter 'key')
   at System.Collections.Generic.Dictionary`2.FindValue(TKey key)
   at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
   at ITravel_App.Services.BookingPdfService.GenerateBookingPdf(BookingWithTripDetailsAll _model) in D:\horizen\api\ITravel_App\ITravel_App\Services\BookingPdfService.cs:line 114
   at ITravel_App.Controllers.BookingController.ConfirmBooking(ConfirmBookingReq req) in D:\horizen\api\ITravel_App\ITravel_App\Controllers\BookingController.cs:line 128
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
[2025-10-14 12:47:04.909 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 500 null text/plain; charset=utf-8 12821.6727ms
[2025-10-14 12:47:27.394 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:47:27.395 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:47:27.400 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:47:27.401 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:47:27.555 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:47:27.562 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:47:27.566 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:50:49.852 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 12:50:51.356 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 12:50:51.357 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 12:50:51.595 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 12:50:51.596 +03:00  INF]  Hosting environment: Development
[2025-10-14 12:50:51.596 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 12:50:52.569 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 12:50:52.996 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 440.8362ms
[2025-10-14 12:50:53.038 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 12:50:53.071 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 12:50:53.127 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 88.6979ms
[2025-10-14 12:50:53.227 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 155.907ms
[2025-10-14 12:50:53.303 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 12:50:53.453 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 149.5159ms
[2025-10-14 12:51:43.205 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:51:43.223 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:51:43.612 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:51:43.666 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:51:47.131 +03:00  INF]  Executed DbCommand (159ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:51:47.696 +03:00  INF]  Executed DbCommand (18ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:51:47.763 +03:00  INF]  Executed DbCommand (14ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:52:03.470 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 19796.2199ms
[2025-10-14 12:52:03.472 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:52:03.478 +03:00  ERR]  An unhandled exception has occurred while executing the request.
System.ArgumentNullException: Value cannot be null. (Parameter 'key')
   at System.Collections.Generic.Dictionary`2.FindValue(TKey key)
   at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
   at ITravel_App.Services.BookingPdfService.GenerateBookingPdf(BookingWithTripDetailsAll _model) in D:\horizen\api\ITravel_App\ITravel_App\Services\BookingPdfService.cs:line 114
   at ITravel_App.Controllers.BookingController.ConfirmBooking(ConfirmBookingReq req) in D:\horizen\api\ITravel_App\ITravel_App\Controllers\BookingController.cs:line 128
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
[2025-10-14 12:52:03.526 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 500 null text/plain; charset=utf-8 20321.8214ms
[2025-10-14 12:52:08.859 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:52:08.860 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:52:08.903 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:52:08.904 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:52:08.953 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:52:08.968 +03:00  INF]  Executed DbCommand (5ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:52:08.979 +03:00  INF]  Executed DbCommand (8ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:52:09.245 +03:00  INF]  Executed DbCommand (10ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:52:09.252 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:52:09.325 +03:00  INF]  Executed DbCommand (22ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:52:33.247 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:52:33.289 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 24385.0864ms
[2025-10-14 12:52:33.289 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:52:33.291 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 4 application/json; charset=utf-8 24431.879ms
[2025-10-14 12:53:20.552 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:53:20.560 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:53:20.566 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:53:20.566 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:53:20.749 +03:00  INF]  Executed DbCommand (7ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:53:20.757 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:53:20.761 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:53:20.765 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:53:20.767 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:53:20.773 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:53:28.166 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:53:28.167 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 7599.8747ms
[2025-10-14 12:53:28.167 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:53:28.167 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 4 application/json; charset=utf-8 7615.7941ms
[2025-10-14 12:54:02.415 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:54:02.415 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:54:02.416 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:54:02.416 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:54:02.420 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:54:02.425 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:54:02.458 +03:00  INF]  Executed DbCommand (30ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:54:09.971 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 7554.9058ms
[2025-10-14 12:54:09.972 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:54:09.973 +03:00  ERR]  An unhandled exception has occurred while executing the request.
System.ArgumentNullException: Value cannot be null. (Parameter 'key')
   at System.Collections.Generic.Dictionary`2.FindValue(TKey key)
   at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
   at ITravel_App.Services.BookingPdfService.GenerateBookingPdf(BookingWithTripDetailsAll _model) in D:\horizen\api\ITravel_App\ITravel_App\Services\BookingPdfService.cs:line 114
   at ITravel_App.Controllers.BookingController.ConfirmBooking(ConfirmBookingReq req) in D:\horizen\api\ITravel_App\ITravel_App\Controllers\BookingController.cs:line 128
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
[2025-10-14 12:54:09.978 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 500 null text/plain; charset=utf-8 7562.8929ms
[2025-10-14 12:54:15.340 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - application/json-patch+json 62
[2025-10-14 12:54:15.340 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:54:15.341 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:54:15.341 +03:00  INF]  Route matched with {action = "ConfirmBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConfirmBooking(ITravelApp.Data.Models.Bookings.ConfirmBookingReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:54:15.344 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__req_booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__req_booking_id_0
LIMIT 2
[2025-10-14 12:54:15.347 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:54:15.350 +03:00  INF]  Executed DbCommand (3ms) [Parameters=[@__req_lang_code_0='?', @__req_booking_id_1='?' (DbType = Int64), @__req_client_id_2='?'], CommandType='"Text"', CommandTimeout='30']
SELECT b.booking_code, b.booking_code_auto, b.booking_date, b.booking_datestr, b.booking_id, b.booking_notes, b.booking_status, b.booking_status_id, b.cancelation_policy, b.child_ages, b.child_num, b.client_email, b.client_id, b.client_name, b.client_nationality, b.client_phone, b.currency_code, b.default_img, b.gift_code, b.infant_num, b.is_two_way, b.lang_code, b.pickup_address, b.pickup_time, b.pricing_type, b.release_days, b.review_rate, b.total_pax, b.total_price, b.trip_code, b.trip_code_auto, b.trip_date, b.trip_datestr, b.trip_description, b.trip_id, b.trip_name, b.trip_return_date, b.trip_return_datestr, b.trip_type
FROM bookingwithdetails AS b
WHERE b.lang_code = @__req_lang_code_0 AND b.booking_id = @__req_booking_id_1 AND b.client_id = @__req_client_id_2
LIMIT 2
[2025-10-14 12:54:15.353 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:54:15.355 +03:00  INF]  Executed DbCommand (1ms) [Parameters=[@__ToLower_1='?', @__is_obligatory_2='?' (DbType = Boolean), @__booking_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT b.extra_id, b.booking_id, b.extra_count, f0.facility_name AS extra_name, f2.extra_price, b.id, f2.is_obligatory, f2.is_extra AS "isExtra", f2.pricing_type::int AS pricing_type
FROM booking_extra AS b
INNER JOIN (
    SELECT f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON b.extra_id::bigint = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.is_obligatory = @__is_obligatory_2
) AS f2 ON f0.facility_id = f2.id
WHERE b.booking_id = @__booking_id_0
[2025-10-14 12:54:15.358 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__ToLower_2='?', @__req_trip_id_0='?' (DbType = Int64), @__req_trip_type_1='?' (DbType = Int16)], CommandType='"Text"', CommandTimeout='30']
SELECT t.id::numeric AS trip_pickup_id, t1.lang_code, t."order", t.pickup_code, t.pickup_default_name, t1.pickup_description, t1.pickup_name, t.trip_id, t.trip_type, t.duration
FROM trip_pickups_main AS t
INNER JOIN (
    SELECT t0.lang_code, t0.pickup_description, t0.pickup_name, t0.trip_pickup_id
    FROM trip_pickups_translations AS t0
    WHERE lower(t0.lang_code) = @__ToLower_2
) AS t1 ON t.id = t1.trip_pickup_id
WHERE t.trip_id = @__req_trip_id_0 AND t.trip_type = @__req_trip_type_1
ORDER BY t."order"
[2025-10-14 12:54:22.751 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Boolean'.
[2025-10-14 12:54:22.752 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App) in 7410.8373ms
[2025-10-14 12:54:22.752 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.ConfirmBooking (ITravel_App)'
[2025-10-14 12:54:22.752 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/ConfirmBooking - 200 4 application/json; charset=utf-8 7412.8347ms
[2025-10-14 12:55:46.352 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 12:55:47.345 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 12:55:47.346 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 12:55:47.851 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 12:55:47.851 +03:00  INF]  Hosting environment: Development
[2025-10-14 12:55:47.851 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 12:55:48.918 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 12:55:49.560 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 657.4095ms
[2025-10-14 12:55:50.740 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 12:55:50.775 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 35.1639ms
[2025-10-14 12:55:50.907 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 12:55:51.044 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 136.9012ms
[2025-10-14 12:55:51.547 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 12:55:51.809 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 262.3344ms
[2025-10-14 12:57:07.572 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/CancelBooking?booking_id=43 - null 0
[2025-10-14 12:57:07.610 +03:00  INF]  CORS policy execution successful.
[2025-10-14 12:57:08.000 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.CancelBooking (ITravel_App)'
[2025-10-14 12:57:08.063 +03:00  INF]  Route matched with {action = "CancelBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CancelBooking(System.Nullable`1[System.Int64]) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 12:57:16.885 +03:00  INF]  Executed DbCommand (129ms) [Parameters=[@__booking_id_0='?' (DbType = Int64), @__client_id_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t.id, t.booking_code, t.booking_code_auto, t.booking_date, t.booking_notes, t.booking_status, t.child_ages, t.child_num, t.client_email, t.client_id, t.client_name, t.client_nationality, t.client_phone, t.currency_code, t.gift_code, t.infant_num, t.is_two_way, t.pickup_address, t.pickup_time, t.pricing_type, t.total_pax, t.total_price, t.trip_code, t.trip_date, t.trip_id, t.trip_return_date, t.trip_type
FROM trips_booking AS t
WHERE t.id = @__booking_id_0 AND t.client_id = @__client_id_1
LIMIT 2
[2025-10-14 12:57:17.430 +03:00  INF]  Executed DbCommand (19ms) [Parameters=[@p26='?' (DbType = Int64), @p0='?', @p1='?', @p2='?' (DbType = DateTime2), @p3='?', @p4='?' (DbType = Int32), @p5='?', @p6='?' (DbType = Int32), @p7='?', @p8='?', @p9='?', @p10='?', @p11='?', @p12='?', @p13='?', @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?', @p17='?', @p18='?' (DbType = Int16), @p19='?' (DbType = Int32), @p20='?' (DbType = Decimal), @p21='?', @p22='?' (DbType = DateTime2), @p23='?' (DbType = Int64), @p24='?' (DbType = DateTime2), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE trips_booking SET booking_code = @p0, booking_code_auto = @p1, booking_date = @p2, booking_notes = @p3, booking_status = @p4, child_ages = @p5, child_num = @p6, client_email = @p7, client_id = @p8, client_name = @p9, client_nationality = @p10, client_phone = @p11, currency_code = @p12, gift_code = @p13, infant_num = @p14, is_two_way = @p15, pickup_address = @p16, pickup_time = @p17, pricing_type = @p18, total_pax = @p19, total_price = @p20, trip_code = @p21, trip_date = @p22, trip_id = @p23, trip_return_date = @p24, trip_type = @p25
WHERE id = @p26;
[2025-10-14 12:57:17.470 +03:00  INF]  Executing OkObjectResult, writing value of type 'ITravelApp.Data.Models.ResponseCls'.
[2025-10-14 12:57:17.614 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.CancelBooking (ITravel_App) in 9543.8618ms
[2025-10-14 12:57:17.615 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.CancelBooking (ITravel_App)'
[2025-10-14 12:57:17.633 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/CancelBooking?booking_id=43 - 200 51 application/json; charset=utf-8 10060.8682ms
[2025-10-14 14:10:41.056 +03:00  INF]  User profile is available. Using 'C:\Users\Pro\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-10-14 14:10:42.286 +03:00  INF]  Now listening on: https://localhost:7045
[2025-10-14 14:10:42.287 +03:00  INF]  Now listening on: http://localhost:5124
[2025-10-14 14:10:43.888 +03:00  INF]  Application started. Press Ctrl+C to shut down.
[2025-10-14 14:10:43.888 +03:00  INF]  Hosting environment: Development
[2025-10-14 14:10:43.888 +03:00  INF]  Content root path: D:\horizen\api\ITravel_App\ITravel_App
[2025-10-14 14:10:44.467 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/index.html - null null
[2025-10-14 14:10:45.191 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/index.html - 200 null text/html;charset=utf-8 738.5151ms
[2025-10-14 14:10:45.234 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - null null
[2025-10-14 14:10:45.235 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/_vs/browserLink - null null
[2025-10-14 14:10:45.245 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 10.7416ms
[2025-10-14 14:10:45.346 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/_vs/browserLink - 200 null text/javascript; charset=UTF-8 110.933ms
[2025-10-14 14:10:45.571 +03:00  INF]  Request starting HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - null null
[2025-10-14 14:10:45.741 +03:00  INF]  Request finished HTTP/2 GET https://localhost:7045/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 170.0275ms
[2025-10-14 14:11:37.854 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetTrip_Extra_Mains - application/json-patch+json 83
[2025-10-14 14:11:37.865 +03:00  INF]  CORS policy execution successful.
[2025-10-14 14:11:38.467 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App)'
[2025-10-14 14:11:38.546 +03:00  INF]  Route matched with {action = "GetTrip_Extra_Mains", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetTrip_Extra_Mains(ITravelApp.Data.Models.Bookings.TripExtraReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 14:11:43.202 +03:00  INF]  Executed DbCommand (153ms) [Parameters=[@__ToLower_1='?', @__req_isExtra_2='?' (DbType = Boolean), @__req_is_obligatory_3='?' (DbType = Boolean), @__req_trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT f0.facility_desc, f0.facility_name, f2.extra_price, f2.currency_code, f2.is_extra, t.facility_id, f2.pricing_type, f2.is_obligatory
FROM trip_facility AS t
INNER JOIN (
    SELECT f.facility_desc, f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON t.facility_id = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.currency_code, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.active AND f1.is_extra = @__req_isExtra_2 AND f1.is_obligatory = @__req_is_obligatory_3
) AS f2 ON t.facility_id = f2.id
WHERE t.trip_id = @__req_trip_id_0
[2025-10-14 14:11:43.298 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[ITravelApp.Data.Models.trips.TripFacility, ITravelApp.Data, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
[2025-10-14 14:11:43.406 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App) in 4852.9142ms
[2025-10-14 14:11:43.406 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App)'
[2025-10-14 14:11:43.420 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetTrip_Extra_Mains - 200 337 application/json; charset=utf-8 5565.806ms
[2025-10-14 14:12:00.532 +03:00  INF]  Request starting HTTP/2 POST https://localhost:7045/api/Booking/GetTrip_Extra_Mains - application/json-patch+json 84
[2025-10-14 14:12:00.534 +03:00  INF]  CORS policy execution successful.
[2025-10-14 14:12:00.558 +03:00  INF]  Executing endpoint 'ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App)'
[2025-10-14 14:12:00.559 +03:00  INF]  Route matched with {action = "GetTrip_Extra_Mains", controller = "Booking"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetTrip_Extra_Mains(ITravelApp.Data.Models.Bookings.TripExtraReq) on controller ITravel_App.Controllers.BookingController (ITravel_App).
[2025-10-14 14:12:00.619 +03:00  INF]  Executed DbCommand (2ms) [Parameters=[@__ToLower_1='?', @__req_isExtra_2='?' (DbType = Boolean), @__req_is_obligatory_3='?' (DbType = Boolean), @__req_trip_id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT f0.facility_desc, f0.facility_name, f2.extra_price, f2.currency_code, f2.is_extra, t.facility_id, f2.pricing_type, f2.is_obligatory
FROM trip_facility AS t
INNER JOIN (
    SELECT f.facility_desc, f.facility_id, f.facility_name
    FROM facility_translations AS f
    WHERE lower(f.lang_code) = @__ToLower_1
) AS f0 ON t.facility_id = f0.facility_id
INNER JOIN (
    SELECT f1.id, f1.currency_code, f1.extra_price, f1.is_extra, f1.is_obligatory, f1.pricing_type
    FROM facility_main AS f1
    WHERE f1.active AND f1.is_extra = @__req_isExtra_2 AND f1.is_obligatory = @__req_is_obligatory_3
) AS f2 ON t.facility_id = f2.id
WHERE t.trip_id = @__req_trip_id_0
[2025-10-14 14:12:00.621 +03:00  INF]  Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[ITravelApp.Data.Models.trips.TripFacility, ITravelApp.Data, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
[2025-10-14 14:12:00.623 +03:00  INF]  Executed action ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App) in 64.3027ms
[2025-10-14 14:12:00.623 +03:00  INF]  Executed endpoint 'ITravel_App.Controllers.BookingController.GetTrip_Extra_Mains (ITravel_App)'
[2025-10-14 14:12:00.624 +03:00  INF]  Request finished HTTP/2 POST https://localhost:7045/api/Booking/GetTrip_Extra_Mains - 200 185 application/json; charset=utf-8 92.2947ms
